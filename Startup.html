<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="weatherApp.css">
  <title>React Startup Code</title>
</head>

<body>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js" crossorigin></script>
  <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>

  <form action="Startup.html" method="get">
    <div class="form-group search">
      <input type="text" class="input" placeholder="search" name="ort">
      <button type="submit"><img src='magnify.svg'></button>
    </div>
  </form>

  <div id="content">

  </div>

  <script type="text/babel">

    // React since react V4 does not read query parameters so we read query parameter directly

    /* const urlParams = new URLSearchParams(window.location.search);
    const ort = urlParams.get('ort');

    if (ort != null) alert(ort); */
    class Comment extends React.Component {
      constructor(props) {
        super(props);

        this.state = {
          ...props
        };

        console.log(this.state);
      }

      render() {
        const divStyle = {
          border: '1px solid black',
          margin: '5px',
          padding: '5px',
        };

        return (
          <div style={divStyle}>
            <h3>
              {this.state.data.commentid} {!!this.state.data.replyto ? <span> reply to: {this.state.data.replyto} </span> : ''}
            </h3>

            <p>
              {this.state.data.content}
            </p>

            <p>
              author: {!!this.state.data.username ? this.state.data.username : 'Anonym användare'} commented on: {this.state.data.posted.toString()}
            </p>
          </div>
        );
      }
    }


    class Comments extends React.Component {
      constructor(props) {
        super(props);

        this.state = {
          data: [
            {
              id: "1",
              location: "Grums",
              replyto: null,
              author: "1",
              content: "Vaknade upp av stanken från pappersbruket som vinden tryckte framför sig längs älven.",
              posted: "2021-11-01 09:30",
              username: "Greger Ohlsson",
              email: "greger.olsson@net.nu",
              favlocation: "Grums",
              image: null,
              user: "2",
              comment: "1111",
              commentid: "1111",
              nolikes: 1,
            },
            {
              id: "3",
              location: "Grums",
              replyto: "1111",
              author: "3",
              content: "På denna sidan av älven är det ännu värre.",
              posted: "2021-11-01 09:33",
              username: "Nisse Hult",
              email: "nissehult@net.nu",
              favlocation: "Grums",
              image: null,
              user: null,
              comment: null,
              commentid: "1112",
              nolikes: "0"
            }, {
              id: "4",
              location: "Grums",
              replyto: "1112",
              author: "4",
              content: "Värmlänningar, vilka gnälliga typer.",
              posted: "2021 - 11 - 01 10: 04",
              username: "Glenn Nilsson",
              email: "glen@swnet.se",
              favlocation: "Arjeplog",
              image: null,
              user: "2",
              comment: "1113",
              commentid: "1113",
              nolikes: "1"
            }, {
              id: "3",
              location: "Grums",
              replyto: "1112",
              author: "3",
              content: "Det är så illa nu, så att snuset smakar kvavt.",
              posted: "2021 - 11 - 03 10: 07",
              username: "Nisse Hult",
              email: "nissehult @net.nu",
              favlocation: "Grums",
              image: null,
              user: "1",
              comment: "1114",
              commentid: "1114",
              nolikes: "3"
            }, {
              id: "4",
              location: "Grums",
              replyto: "1112",
              author: "4",
              content: "Här uppe i norr är det så kallt denna veckan så att snuset fryser i fickan och värmlänningarna klagar på odören från bruket.Veklingar.",
              posted: "2021 - 12 - 07 11: 24",
              username: "Glenn Nilsson",
              email: "glen @swnet.se",
              favlocation: "Arjeplog",
              image: null,
              user: null,
              comment: null,
              commentid: "1115",
              nolikes: "0"
            }
          ]
        };
      }

      render() {
        return (
          <div>
            {this.state.data.map(comment => <Comment key={comment.commentid} data={comment}></Comment>)}
          </div>
        )
      }
    }

    class Climatecode extends React.Component {
      constructor(props) {
        super(props);

        this.state = {
          code: props.code,
          data: [
            {
              code: 'af',
              name: 'Tropical rainforest climate Tropical Rainforest',
              color: '#9600'
            },
            {
              code: 'Am',
              name: 'Tropical monsoon climate Tropical Monsoon',
              color: '#FF000'
            },
          ],
        };
      }

      render() {
        return (
          <div>
            {this.state.data.filter(v => v.code === this.state.code).map(cc => {
              return (
                <div key={cc.code}>
                  <h2> code: {cc.code} </h2>
                  <span>
                    <p> name: {cc.name} </p>
                    <p> color: {cc.color} </p>
                  </span>
                </div>
              );
            })}
          </div>
        );
      }
    }

    /* Auxdata (the forecast data) */
    class AuxData extends React.Component {
      constructor(props) {
        super(props);
        this.state = props.data;
      }

      render() {
        return (
          <p>
            {this.state.TVALUE} {this.state.TUNIT}
          </p>
        )
      }
    }

    /* Forecast component */
    class Forecast extends React.Component {
      constructor(props) {
        super(props);
        this.state = {
          name: props.name,
          data: [
            {
              fromtime: new Date().toString(),
              todate: new Date().toString(),
              periodno: 1,
              periodname: 'morning',
              forecast: { "TUNIT": "celsius", "TVALUE": "-9.3", "ALTUNIT": "fahrenheit", "ALTVALUE": "15.26", "NUMBER": "10", "WSYMB3NUMBER": "23", "FNAME": "Sleet", "RUNIT": "mm", "RVALUE": "1.6", "DEG": "268", "CODE": "WSW", "NAME": "West-southwest", "MPS": "5.7", "NAME": "Moderate Breeze", "UNIT": "hPa", "VALUE": "1294" },
            },
            {
              fromtime: new Date().toString(),
              todate: new Date().toString(),
              periodno: 0,
              periodname: 'night',
              forecast: { "TUNIT": "celsius", "TVALUE": "-9.3", "ALTUNIT": "fahrenheit", "ALTVALUE": "15.26", "NUMBER": "10", "WSYMB3NUMBER": "23", "FNAME": "Sleet", "RUNIT": "mm", "RVALUE": "1.6", "DEG": "268", "CODE": "WSW", "NAME": "West-southwest", "MPS": "5.7", "NAME": "Moderate Breeze", "UNIT": "hPa", "VALUE": "1294" },
            }
          ],
        };
      }

      render() {
        return (
          <div>
            <h1> {this.state.name} </h1>
            <table>
              <thead>
                <tr>
                  <th> periodno </th>
                  <th> periodname </th>
                  <th> fromtime </th>
                  <th> todate </th>
                  <th> forecast </th>
                </tr>
              </thead>

              <tbody>
                {this.state.data.map(forecastData =>
                  <tr key={forecastData.periodno}>
                    <td> {forecastData.periodno} </td>
                    <td> {forecastData.periodname} </td>
                    <td> {forecastData.fromtime} </td>
                    <td> {forecastData.todate} </td>
                    <td> <AuxData data={forecastData.forecast}></AuxData> </td>
                  </tr>
                )}
              </tbody>
            </table>
          </div>
        )
      }
    }

    /* INFO component */
    class Info extends React.Component {
      constructor(props) {
        super(props);
        this.handleClick = this.handleClick.bind(this);
        this.state = {
          name: 'test',
          type: 'admin type',
          country: 'Sverige',
          about: 'en test typ',
          province: 'västergötland',
          municipality: 'skövde',
          climatecode: 'af',
          climate: 'ett klimat',
          postalcode: 'postal 123',
          areacode: 'area code'
        }
      }

      handleClick() {

      }

      render() {
        return (
          <div>
            <div>
              <h1> {this.state.name}</h1>
              <ul>
                <li> type: {this.state.type} </li>
                <li> country: {this.state.country} </li>
                <li> province: {this.state.province} </li>
                <li> municipality: {this.state.municipality} </li>
                <li> postalCode: {this.state.postalcode} </li>
                <li> areaCode: {this.state.areacode} </li>
                <li> climate: {this.state.climate} </li>
                <li> about: {this.state.about} </li>
              </ul>
            </div>

            <Climatecode code={this.state.climatecode}></Climatecode>

            <Forecast name={this.state.name}></Forecast>

            <Comments name={this.state.name}></Comments>
          </div>);
      }
    }

    ReactDOM.render(<Info />, document.getElementById("content"));

  </script>
</body>

</html>
